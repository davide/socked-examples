<!doctype html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta HTTP-equiv="X-UA-Compatible" content="IE=EDGE">
    <title>Socked - Mouselive Receiver</title>
    <script type="text/javascript" src="../servers.js"></script>
    <script type="text/javascript" src="../utils/parseuri.js"></script>
    <script type="text/javascript" language="javascript" src="http://cdn.sockjs.org/sockjs-0.2.min.js"></script>
    <script type="text/javascript" language="javascript" src="../releases/socked-0.1.min.js"></script>
</head>
<body>

  <img id="cursor" style="position:absolute;top:-30px;left:-30px;margin-top:-15px;margin-left:-15px" src="Map_pointer.svg" />

  <script type="text/javascript">
    Socked.ready(function(){
      var uri = parseUri(window.location);
      var serverId = uri.queryKey['s'];
      var server = servers[serverId] || servers[0];

      var connectionId = 'connection1';
      var channelName = 'mouselive';
      try {  
        Socked.createConnection({id:connectionId, server:server, appKey:'myKey',
            channels: [{name:channelName}]
          });
      } catch(e) {
        console.log('Error setting up connection!');
        return;
      }
    
      var cursor = document.getElementById("cursor");

      var subscriptionOptions = {role: "receiver"};
      var ref = Socked.subscribe(connectionId, channelName, subscriptionOptions);
      if (ref === null) {
        console.log('Channel not found: ', channelName);
      }
      ref.onConnect(function() {
          console.log('connected to ', channelName);
  		}).onMessage(function(msg) {
          var mousePosition = JSON.parse(msg);
          var x = mousePosition.shift();
          var y = mousePosition.shift();
          cursor.style.left = x + 'px';
          cursor.style.top = y + 'px';
  		}).onDisconnect(function() {
          console.log('disconnected from ', channelName);
  		});
    });
  </script>

</body>
</html>

